<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Job Matching</title>
    <link rel="stylesheet" href="jobmatch.css" />
    <link rel="stylesheet" href="mainPageStyle.css" />
</head>
<body>

<header class="navbar">
    <div class="container">
        <div class="logo">JobLens AI</div>
        <nav class="nav-links">
            <a href="mainPage.html">Home</a>
            <a href="jobmatch.html">Smart Job Matching</a>
            <a href="interviewCoach.html">Interview Coach</a>
            <a href="#">Skill Gap Analyzer</a>
            <a href="#">Roadmaps</a>
            <a href="aboutUs.html">About Us</a>
        </nav>
        <a href="#" class="btn btn-primary">Get Started</a>
    </div>
</header>

<section class="profile-section">
    <h2>Your Profile</h2>
    <form>
        <div class="res-inp">
            <p>Upload Resume :</p>
            <input type="file" accept=".pdf,.doc,.docx" placeholder="Upload Resume" />
        </div>
        <input type="text" id="skills-input" placeholder="Skills (comma separated)" />
        <input type="text" placeholder="Experience in years" />
        <input type="text" placeholder="Education" />
        <input type="text" placeholder="Job Preferences" />
        <input type="text" placeholder="Enter GitHub" />
        <input type="text" placeholder="Enter LinkedIn" />
        <button type="submit" class="btn btn-primary">Save Profile</button>
    </form>
</section>

<section class="jobs-section">
    <h2>Matched Jobs</h2>

    <div class="job-filters">
        <input type="text" id="filter-keyword" placeholder="Search by keyword" />
        <select id="filter-location">
            <option value="">All Locations</option>
            <!-- Locations will be populated dynamically -->
        </select>
        <select id="filter-sortby">
            <option value="">Sort By</option>
            <option value="match">Best Match</option>
            <option value="salary">Highest Salary</option>
        </select>
        <input type="number" id="filter-min-salary" placeholder="Min Salary" />
        <input type="number" id="filter-max-salary" placeholder="Max Salary" />
        <button id="apply-filters-btn" class="btn btn-primary">Apply Filters</button>
    </div>

    <div class="job-grid"></div>
</section>

<section class="skill-gap">
    <h2>Skill Gap Insights</h2>
    <p>Skills you already have:</p>
    <div class="skills-list">
        <span>HTML</span>
        <span>CSS</span>
        <span>JavaScript</span>
    </div>
    <p style="margin-top: 1rem;">Skills you need to learn:</p>
    <div class="skills-list skills-missing">
        <span>React <a href="#">(Learn)</a></span>
        <span>Node.js <a href="#">(Learn)</a></span>
        <span>SQL <a href="#">(Learn)</a></span>
    </div>
</section>

<footer>
    &copy; 2025 SmartJobs. All rights reserved.
</footer>

<script>
// Load locations when page loads
window.addEventListener('load', async () => {
    try {
        const response = await fetch('http://localhost:8000/api/locations');
        const data = await response.json();
        
        if (data.success) {
            const locationSelect = document.getElementById('filter-location');
            data.locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location;
                locationSelect.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Error loading locations:', error);
    }
});

async function fetchAndRenderJobs() {
    const skillsRaw = document.getElementById('skills-input').value;
    const skills = skillsRaw.split(',').map(s => s.trim()).filter(Boolean);
    if (skills.length === 0) {
        alert('Please enter at least one skill.');
        return;
    }

    const location = document.getElementById('filter-location').value || null;
    const min_salary = parseInt(document.getElementById('filter-min-salary').value) || null;
    const max_salary = parseInt(document.getElementById('filter-max-salary').value) || null;

    const payload = { skills, location, min_salary, max_salary };

    const res = await fetch('http://localhost:8000/api/match-jobs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
    });

    if (!res.ok) {
        const err = await res.json();
        alert('Error: ' + (err.detail || 'Failed to fetch jobs'));
        return;
    }

    const data = await res.json();

    const jobGrid = document.querySelector('.job-grid');
    jobGrid.innerHTML = '';

    if (!data.success || data.total_matches === 0) {
        jobGrid.innerHTML = '<p>No matching jobs found.</p>';
        return;
    }

    if (document.getElementById('filter-sortby').value === 'salary') {
        data.matches.sort((a, b) => (b.job.salary_max || 0) - (a.job.salary_max || 0));
    }

    data.matches.forEach(match => {
        const job = match.job;
        const gapSkills = job.required_skills.filter(skill => !match.matching_skills.includes(skill));
        const preferredSkills = job.preferred_skills || [];

        const card = document.createElement('div');
        card.classList.add('job-card');
        card.innerHTML = `
            <h3>${job.title}</h3>
            <p><strong>Company:</strong> ${job.company}</p>
            <p><strong>Location:</strong> ${job.location} ${job.remote_option ? '(Remote available)' : ''}</p>
            <p><strong>Experience:</strong> ${job.experience_level}</p>
            <p><strong>Salary:</strong> $${job.salary_min || '-'} - $${job.salary_max || '-'}</p>
            <p><strong>Required Skills:</strong> ${job.required_skills.join(', ') || '-'}</p>
            <p><strong>Preferred Skills:</strong> ${preferredSkills.join(', ') || '-'}</p>
            <div class="job-tags">
                <span>Skill Match: ${match.match_score}%</span>
                <span>Gap Skills: ${gapSkills.join(', ') || '-'}</span>
            </div>
            <p style="font-style: italic; color: gray;">${match.explanation}</p>
            <a href="#" class="btn btn-primary apply-btn">Apply Now</a>
        `;
        jobGrid.appendChild(card);
    });
}

document.querySelector('.profile-section form').addEventListener('submit', (e) => {
    e.preventDefault();
    fetchAndRenderJobs();
});

document.getElementById('apply-filters-btn').addEventListener('click', (e) => {
    e.preventDefault();
    fetchAndRenderJobs();
});
</script>

</body>
</html>
